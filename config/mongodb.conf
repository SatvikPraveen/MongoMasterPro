# Location: `/config/mongodb.conf`
# MongoDB Configuration File - Single Instance Setup
# Optimized for MongoMasterPro learning environment

# =============================================================================
# STORAGE CONFIGURATION
# =============================================================================
storage:
  dbPath: /data/db
  journal:
    enabled: true
    commitIntervalMs: 100
  engine: wiredTiger
  wiredTiger:
    engineConfig:
      cacheSizeGB: 1
      journalCompressor: snappy
      directoryForIndexes: false
    collectionConfig:
      blockCompressor: snappy
    indexConfig:
      prefixCompression: true

# =============================================================================
# SYSTEM LOG CONFIGURATION
# =============================================================================
systemLog:
  destination: file
  logAppend: true
  path: /var/log/mongodb/mongod.log
  logRotate: reopen
  component:
    accessControl:
      verbosity: 1
    command:
      verbosity: 1
    control:
      verbosity: 1
    query:
      verbosity: 1
    write:
      verbosity: 1
    storage:
      verbosity: 1
    index:
      verbosity: 1

# =============================================================================
# NETWORK CONFIGURATION
# =============================================================================
net:
  port: 27017
  bindIp: 0.0.0.0
  maxIncomingConnections: 65536
  compression:
    compressors: snappy,zlib,zstd
  serviceExecutor: adaptive

# =============================================================================
# PROCESS MANAGEMENT
# =============================================================================
processManagement:
  fork: false
  pidFilePath: /var/run/mongodb/mongod.pid
  timeZoneInfo: /usr/share/zoneinfo

# =============================================================================
# SECURITY CONFIGURATION
# =============================================================================
security:
  authorization: enabled
  javascriptEnabled: true
  keyFile: /app/config/replica.key
  clusterAuthMode: keyFile

# =============================================================================
# OPERATION PROFILING
# =============================================================================
operationProfiling:
  slowOpThresholdMs: 100
  mode: slowOp
  slowOpSampleRate: 1.0

# =============================================================================
# REPLICA SET CONFIGURATION (Single Node)
# =============================================================================
replication:
  replSetName: rs0
  enableMajorityReadConcern: true

# =============================================================================
# SHARDING CONFIGURATION (Disabled for single instance)
# =============================================================================
# sharding:
#   clusterRole: shardsvr

# =============================================================================
# SET PARAMETERS
# =============================================================================
setParameter:
  enableLocalhostAuthBypass: false
  authenticationMechanisms: SCRAM-SHA-1,SCRAM-SHA-256
  scramIterationCount: 15000
  maxLogSizeKB: 10
  logLevel: 1
  quiet: false
  syncdelay: 60
  wiredTigerConcurrentReadTransactions: 128
  wiredTigerConcurrentWriteTransactions: 128
  wiredTigerEngineRuntimeConfig: "checkpoint=(wait=60)"
  diagnosticDataCollectionEnabled: true
  logicalSessionRefreshMinutes: 5
  transactionLifetimeLimitSeconds: 60
  maxTransactionLockRequestTimeoutMillis: 5000
  featureCompatibilityVersion: "7.0"

# =============================================================================
# AUDIT LOG (Enterprise feature - commented for Community)
# =============================================================================
# auditLog:
#   destination: file
#   format: JSON
#   path: /var/log/mongodb/audit.log
#   filter: '{ atype: { $in: ["authenticate", "authCheck", "createUser", "dropUser"] } }'

# =============================================================================
# MONGODB COMPASS CONNECTION
# =============================================================================
# Optimized for MongoDB Compass and development tools
# Connection string: mongodb://app_user:app_secure_pass@localhost:27017/learning_platform?authSource=admin
